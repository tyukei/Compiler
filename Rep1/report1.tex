\documentclass[a4j]{jsarticle}
\usepackage{color}
\usepackage{multicol}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{listings,jlisting}
\usepackage[dvipdfmx]{graphicx}
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{pdfpages}


\lstset{
language={C},
backgroundcolor={\color[gray]{.85}},
basicstyle={\small},
identifierstyle={\small},
commentstyle={\small\ttfamily \color[rgb]{0,0.5,0}},
keywordstyle={\small\bfseries \color[rgb]{0.5,0,0.8}},
ndkeywordstyle={\small},
stringstyle={\small\ttfamily \color[rgb]{0,0,1}},
showstringspaces={false},
frame={tb},
breaklines=true,
columns=[l]{fullflexible},
numbers=left,
xrightmargin=0zw,
xleftmargin=3zw,
numberstyle={\scriptsize},
stepnumber=1,
numbersep=1zw,
morecomment=[l]{//}
}

\lstset{
otherkeywords={Uword,Cpub,step},
morekeywords={Uword,Cpub,step},
classoffset=0, keywordstyle=\color{violet}, deletekeywords={step},
classoffset=1, keywordstyle=\color{brown}, morekeywords={step},
classoffset=0,
}

\pagestyle{fancy}
\rhead{\thepage}
\cfoot{\empty}
\lhead{\leftmark}

\title{言語処理プログラミング}
\author{情報工学3年　20122041　中田継太}
\date{\today}
\begin{document}
\maketitle
\clearpage
\setcounter{tocdepth}{3}
\tableofcontents
\clearpage

\section{演習の目的}
\begin{itemize}
  \item コンパイラの基本的な構造とテキスト処理の手法を理解すること.
  \item 比較的大きなプログラムを作成する経験を得ること．
\end{itemize}

\section{演習内容}
MPPLを読み込み，字句 (トークン) がそれぞれ何個出現したかを数え，出力するプログラムを作成した．

\section{プログラムの設計情報}
  \subsection{全体構成}
  ここではどのようなモジュールがあるか，それらの依存関係について述べる。\\
  プログラムは以下の4つのファイルで構成されている

    \paragraph{token-list.c}
    　\\
    main関数があり、それぞれのモジュールを呼び出し、ファイルの読み込みから画面への出力を行うモジュール。scan-list.cを呼び出しファイルの読み込みを行う。token-list.hを呼び出し、配列サイズや構造体keyといった定数、宣言を収得する。

    \paragraph{id-list.c}
    　\\
    名前を実体ごとに出現個数を数えあげるモジュール。
    id\_countup()関数はscan-list.cからトークンNAMEを拾得したとき呼び出される。print\_idtab()はtoken-list.cの画面に出力時に呼び出される。
    release\_idtabはtoken-list.cの終了時に呼び出される。

    \paragraph{scan-list.c}
    　\\
    ファイルの読み込みの初期化
    、トークンの収得およびファイルのクローズといった一連の処理を行うモジュール。
    scan()関数はtoken-list.cから呼び出され実行される。
    \paragraph{token-list.h}
    　\\
    定数トークンや関数の宣言を行うモジュール。
    定数トークンはscan-list.cやtoken-list.cで呼び出される。


  \subsection{各モジュールごとの構成}
  ここでは使用されているデータ構造の説明と各変数の意味を述べる。\\
  \paragraph{idroot:単方向リスト}
  　\\
  拡張機能としてトークンNAMEが返されたとき名前の実体もカウントする実装をおこなった。実体はトークンと異なり、事前にどの種類の者があるか分からない。そこで、情報を後からつなげていくことのできる単方向リストを用いた。単方向リストとは各要素が自分の「次」の要素へのリンクを持ち、先頭側から末尾側へのみたどっていくデータ構造である。\cite{cite:list}。今回は、struct IDを用いて単方向リストを実現させた。valueはNAMEの実体のnameとその実体の数のcountを持つ。そしてnextpが次の格納場所(アドレス)を保持する。
  \begin{lstlisting}[language=C,caption={構造体ID in id-list.c},label={code:id}]
    struct ID {
    	char *name;
    	int count;
    	struct ID *nextp;
    }  *idroot;
  \end{lstlisting}
  　\\
  \paragraph{key:連想配列}
  　\\
  連想配列を用いた(言語によって辞書型、マップ型、ハッシュ テーブルと呼ばれることがある)。連想配列とはデータの場所を表す「キー」と、データの「バリュー」を対応付けて格納したデータ構造である。\cite{cite:list}今回はStrcut KEYを用いて、連想配列を実現させた。keywordはトークンKEYWORDの文字列を保持し、keytokenはトークンKEYWORDのTOKEN番号をkeywordに連結して保持している。
  \begin{lstlisting}[language=C,caption={構造体KEY in token-list.h},label={code:key}]
    struct KEY {
    	char * keyword;
    	int keytoken;
    } key[KEYWORDSIZE];
  \end{lstlisting}

  \paragraph{変数}
  \subparagraph{cub}
  入力は常に1 文字先
読みしておくと便利である．即ち，1 文字分の文字バッファを持っていて，それに次の文字が入っているようにする．以降，この文字バッファを

  \begin{lstlisting}[language=C,caption={各変数 in scan-list.h},label={code:var}]
    int cbuf, num_line = 0;
    int num_attr;
    char string_attr[MAXSTRSIZE];
    FILE *fp = NULL;
  \end{lstlisting}


  \subsection{各関数の外部仕様}
  ここではその関数の機能．引数や戻り値の意味と参照す
る大域変数，変更する大域変数などを記述する。\\

\section{テスト情報}
  \subsection{テストデータ}
  ここでは既に用意されているテストデータについて、ファイル名のみを記述する。\\

  \subsection{テスト結果}
  ここではテストしたすべてのテストデータについて記述する。\\
  \begin{figure}[H]
    \caption{演習室環境でのprogramの実行例}
    \label{code:exe}
    \begin{lstlisting}[backgroundcolor=\color{black},basicstyle=\color{White}]
      $ gcc -o program token-list.c token-list.h id-list.c scan-list.c
      $ ./program test.txt
    \end{lstlisting}
  \end{figure}
  \subsection{テストデータの十分性}
  ここではそれだけのテストでどの程度バグがないことが保証できるかを記述する\\


\section{事前計画と実際の進捗状況}
  \subsection{事前計画}
  事前計画は\ref{tab:schedule}のようになった。
  \begin{table}[H]
    \centering
    \caption{事前作業計画}
    \label{tab:schedule}
    \begin{tabular}{|l|l|l|l|l|l|}
      \hline
      開始予定日&終了予定日&見積もり時間&番号&作業内容\\ \hline
      10/03 & 10/03 & 1 & (a) & スケジュールを立てる \\ \hline
      10/04 & 10/04 & 0.5 & (b-1) & 配布された資料を読み直す \\ \hline
      10/04 & 10/04 & 0.5 & (b-2) & 配布されたプログラムを読む \\ \hline
      10/04 & 10/04 & 1 & (b-3) & コンパイラのテキスト(プログラム)を読む \\ \hline
      10/05 & 10/07 & 5 & (c) & 字句解析系(スキャナ)の概略設計 \\ \hline
      10/08 & 10/08 & 2 & (e-1-1) & ブラックボックステスト用プログラムの作成 \\ \hline
      10/09 & 10/11 & 5 & (d-4) & スキャナの作成 \\ \hline
      10/12 & 10/12 & 1 & (e-1-2) & バグがない場合の想定テスト結果の準備 \\ \hline
      10/13 & 10/13 & 0.5 & (d-1) & トークンカウント用の配列を初期化部分の作成 \\ \hline
      10/13 & 10/13 & 0.5 & (d-2) & トークンをカウント部分の作成 \\ \hline
      10/13 & 10/13 & 1 & (d-3) & カウントした結果の出力部分の作成 \\ \hline
      10/14 & 10/14 & 0.5 & (e-2-1) & カバレッジレベルの決定 \\ \hline
      10/14 & 10/14 & 2 & (e-2-2) & ホワイトボックステスト用プログラムの作成 \\ \hline
      10/15 & 10/15 & 1 & (e-2-3) & バグがない場合の想定テスト結果の準備 \\ \hline
      10/16 & 10/20 & 8 & (f) & テストとデバッグを行う \\ \hline
      10/28 & 10/28 & 1 & (g-1) & 作成したプログラムの設計情報を書く \\ \hline
      10/29 & 10/29 & 1 & (g-2) & テスト情報を書く \\ \hline
      10/30 & 10/30 & 1 & (g-3) & 事前計画と実際の進捗状況を書く \\ \hline
      10/31 & 10/31 & - & (h) & プログラムとレポートの提出 \\ \hline
    \end{tabular}
  \end{table}

  \subsection{事前計画の立て方についての前課題からの改善点}
  課題１の為省略。

  \subsection{実際の進捗状況}
  実際の計画時間は表\ref{tab:schedule2}のようになった。
  \begin{table}[H]
    \centering
    \caption{事前作業計画}
    \label{tab:schedule2}
    \begin{tabular}{|l|l|l|l|l|l|l|}
      \hline
      開始予定日&終了予定日&計画時間&番号&終了日&実際の時間\\ \hline
      10/03 & 10/03 & 1 & (a) & 10/03 & 0.5 \\ \hline
      10/04 & 10/04 & 0.5 & (b-1) & 10/10 & 1 \\ \hline
      10/04 & 10/04 & 0.5 & (b-2) & 10/10 & 1  \\ \hline
      10/04 & 10/04 & 1 & (b-3) & 10/10 & 1  \\ \hline
      10/05 & 10/07 & 5 & (c) & 10/10 & 3  \\ \hline
      10/08 & 10/08 & 2 & (e-1-1) & 10/10 & 1  \\ \hline
      10/09 & 10/11 & 5 & (d-4) & 10/16 & 1  \\ \hline
      10/12 & 10/12 & 1 & (e-1-2) & 10/16 & 5  \\ \hline
      10/13 & 10/13 & 0.5 & (d-1) & 10/16 & 1  \\ \hline
      10/13 & 10/13 & 0.5 & (d-2) & 10/16 & 1  \\ \hline
      10/13 & 10/13 & 1 & (d-3) & 10/16 & 1  \\ \hline
      10/14 & 10/14 & 0.5 & (e-2-1) & 10/16 & 1  \\ \hline
      10/14 & 10/14 & 2 & (e-2-2) & 10/16 & 1  \\ \hline
      10/15 & 10/15 & 1 & (e-2-3) & 10/16 & 1  \\ \hline
      10/16 & 10/20 & 8 & (f) & 10/17 & 5  \\ \hline
      10/28 & 10/28 & 1 & (g-1) & 10/18 & 1  \\ \hline
      10/29 & 10/29 & 1 & (g-2) & 10/18 & 1  \\ \hline
      10/30 & 10/30 & 1 & (g-3) & 10/18 & 1  \\ \hline
      10/31 & 10/31 & - & (h) &  &  \\ \hline
    \end{tabular}
  \end{table}

  \subsection{当初の事前計画と実際の進捗との差の原因}
  表\ref{tab:schedule2}より若干の進行に差があった。特に初期の実装が事前計画よりタイミングが遅くなった。今回は１回目ともあり、例を参考に事前計画を立てた。個人の用事を考慮できていなかったことが原因であった。

  \clearpage
  \section{ソースコード}
  \lstinputlisting[caption=token-list.c, label=code:token-list,language = C]{token-list.c}
  \clearpage

  \lstinputlisting[caption=token-list.h, label=code:token-list_h,language = C]{token-list.h}
  \clearpage

  \lstinputlisting[caption=scan-list.c, label=code:scan-list,language = C]{scan-list.c}
  \clearpage

  \lstinputlisting[caption=id-list.c, label=code:id-list,language = C]{id-list.c}
  \clearpage

  \section{参考文献}
  \begin{thebibliography}{99}
      \bibitem{cite:list}  https://www.techscore.com/blog/2016/10/05/%E9%96%8B%E7%99%BA%E6%96%B0%E5%8D%92%E3%81%AB%E6%8D%A7%E3%81%90%E3%80%81%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%81%A8%E7%89%B9%E5%BE%B4/
  \end{thebibliography}

\end{document}
